<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymelead.org/extras/spring-security">

    <head>
        <title>Modificar Imagen</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="/img/home_243.ico" type="image/x-icon" />
        <link rel="stylesheet" href="/css/index.css" />
        <link rel="stylesheet" href="/css/error.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    </head>

    <body>
        <nav th:replace="/fragments/navbar" :: nav> </nav>
        <br>
            <br>
                <div class="container" style="text-align: center">
                    <img style="width: 400px; height: 200px; border-radius: 15px; margin-top: 0px"
                         th:src="'data:image/jpeg;base64,' + ${#strings.toString(base)}" alt="Imagen">
                        <form th:action="@{/imagen/modificar1/__${idImagen}__}" method="POST" enctype="multipart/form-data"> 
                            <div id="successPopup" class="popup">
                                <div th:if="${error != null}" class="card1">
                                    <div class="card_image"> <img src="/img/deptoPrincipal.png" /> </div>
                                    <div class="card_title title-white">
                                        <h5 style="color: red">** ERROR **</h5>
                                        <h5 th:text="${error}"></h5>
                                    </div>
                                </div>
                            </div>
                            <div id="errorPopup" class="popup">
                                <div th:if="${exito != null}" class="card1">
                                    <div class="card_image"> <img src="/img/casaPrincipal.png" /> </div>
                                    <div class="card_title title-white">
                                        <h5>** EXITO **</h5>
                                        <p th:text="${exito}"></p>
                                    </div>
                                </div>
                            </div>
                            <input name="archivo" type="file" class="form-label" id="inputImagenes" style="width: 310px; text-align: center; margin-top: 5px" required>
                                <div id="imagenPrevia" class="mb-3">
                                    La previsualización de imágenes se mostrará aquí 
                                </div>
                                <input  value="Cargar "type="submit" class="btn btn-primary"/>
                        </form>
                </div> 



                <script>
                    function showSuccessPopup() {
                        var successPopup = document.getElementById("successPopup");
                        successPopup.style.display = "block";

                        // Ocultar el popup después de 5 segundos
                        setTimeout(function () {
                            successPopup.style.display = "none";
                        }, 5000);
                    }

                    // Función para mostrar el popup de error
                    function showErrorPopup() {
                        var errorPopup = document.getElementById("errorPopup");
                        errorPopup.style.display = "block";

                        // Ocultar el popup después de 5 segundos
                        setTimeout(function () {
                            errorPopup.style.display = "none";
                        }, 5000);
                    }

                    // Ejemplo de uso: Mostrar popup de éxito después de un evento exitoso
                    showSuccessPopup();

                    // Ejemplo de uso: Mostrar popup de error después de un evento fallido
                    showErrorPopup();
                </script>
                <script>
                    const inputImagenes = document.getElementById("inputImagenes");
                    const imagenPrevia = document.getElementById("imagenPrevia");
                    const maxFileSizeBytes = 1048576; // 1 megabyte en bytes
                    const maxFileCount = 10;

                    inputImagenes.addEventListener("change", (event) => {
                        imagenPrevia.innerHTML = ""; // Limpia la previsualización anterior
                        const files = event.target.files;
                        let totalSize = 0;

                        if (files.length > maxFileCount) {
                            alert("No se pueden cargar más de " + maxFileCount + " archivos.");
                            inputImagenes.value = ""; // Limpia la selección
                            return;
                        }

                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.size > maxFileSizeBytes) {
                                alert("El archivo " + file.name + " supera el tamaño máximo de 1 megabyte.");
                                inputImagenes.value = ""; // Limpia la selección
                                return;
                            }

                            totalSize += file.size;

                            const imagen = document.createElement("img");
                            imagen.classList.add("img-thumbnail");
                            imagen.width = 100;
                            imagen.height = 100;
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                imagen.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                            imagenPrevia.appendChild(imagen);
                        }

                        if (totalSize > maxFileSizeBytes * maxFileCount) {
                            alert("El tamaño total de los archivos supera los " + maxFileCount + " megabytes.");
                            inputImagenes.value = ""; // Limpia la selección
                            return;
                        }
                    });
                </script>




                <script>
                    var valor = localStorage.getItem('valor');
                    document.getElementById('campo').value = valor;
                </script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
                crossorigin="anonymous"></script>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
                <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

                </body>
                </html>
